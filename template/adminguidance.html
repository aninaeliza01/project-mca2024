{% extends "adminbase.html" %}
{% block title %}Upload Video{% endblock %}
{% block content %}
{% if messages %}
    {% for message in messages %}
        <div class="alert alert-danger" role="alert">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Upload Video</div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data" id="uploadForm">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="id_title">Video Title:</label>
                            <input type="text" class="form-control" id="id_title" name="title" placeholder="Enter video title">
                        </div>
                        <div class="form-group">
                            <label for="id_description">Description:</label>
                            <textarea class="form-control" id="id_description" name="description" rows="3" placeholder="Enter video description"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="id_video_file">Video File:</label>
                            <input type="file" class="form-control-file" id="id_video_file" onchange="validateFileType()" accept="video/*" name="video_file">
                        </div>
                        <button type="submit" class="btn btn-primary">Upload Video</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


{% if videos %}
    <div class="container mt-4">
        <h2>Uploaded Videos</h2>
        <ul class="list-group">
            {% for video in videos %}
                <li class="list-group-item">
                    <h3>{{ video.title }}</h3>
                    <p>{{ video.description }}</p>
                    <video width="320" height="240" controls>
                        <source src="{{ video.video_file.url }}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

<script>
    function validateFileType() {
    var videoFile = document.getElementById('id_video_file').files[0];
    
    if (!videoFile) {
        alert('Please select a video file.');
        return false;
    }

    var allowedExtensions = ['mp4', 'avi', 'mov', 'wmv'];
    var fileExtension = videoFile.name.split('.').pop().toLowerCase();
    if (!allowedExtensions.includes(fileExtension)) {
        alert('Only video files (mp4, avi, mov, wmv) are allowed.');
        document.getElementById('id_video_file').value = ''; // Clear the file input field
        return false;
    }
    return true;
}

    function validateForm(event) {
        var title = document.getElementById('id_title').value;
        var description = document.getElementById('id_description').value;
        
        if (title.trim() === '' || description.trim() === '') {
            alert('Please fill in all fields.');
            event.preventDefault(); // Prevent form submission if validation fails
            return false;
        }

        if (!validateFileType()) {
            event.preventDefault(); // Prevent form submission if file validation fails
            return false;
        }

        return true; // Allow form submission if all validations pass
    }
</script>
{% endblock %}
